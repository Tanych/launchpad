{% extends "base.html" %}
{% load launchpad_extras humanize %}

{% block javascript_extra %}
<script src=""></script>
{% endblock %}

{% block content %}

<div class="libsite-container container">

    <section class="search row pagination">
        <form class="span12" action="{% url "search" %}" method="get">
            <input style="float: left; margin-right: 10px;" name="q" type="text" placeholder="Search" value="{{ q }}"></input>
            <ul>
                {% if prev_page_range %}
                <li><a href="{% url "search" %}?{{ prev_page_range }}">&#x00ab;</a></li>
                {% endif %}

                {% for n, q in page_range %}
                <li {% if n == page %}class="active"{% endif %}><a href="{% url "search" %}?{{q}}">{{ n }}</a></li>
                {% endfor %}

                {% if next_page_range %}
                <li><a href="{% url "search" %}?{{ next_page_range }}">&#x00bb;</a>
                {% endif %}
            </ul> 
        </form>
    </section>

    {% if active_facets %}
    <section id="active-facets">
      <ul>
        {% for facet in active_facets %}
        <li class="{{ facet.name }}">
          <a class="btn" title="remove {{ facet.value }} facet" href="{{ facet.remove_link }}">{{ facet.value }}</a>
        </li>
        {% endfor %}
      </ul>
    </section>
    {% endif %}

    <div class="row">

    <section id="search-results" class="span9">

    {% for doc in search_results.results %}
    <article id="{{ doc.id }}" class="search-result" itemscope itemtype="{{ doc.type }}">
        {% if doc.type == "Book" %}<img title="Book" class="item-type" src="{{ STATIC_URL }}img/book.png">{%endif %}
        {% if doc.type == "VideoObject" %}<img title="Video" class="item-type" src="{{ STATIC_URL }}img/video.png">{% endif %}
        {% if doc.type == "AudioObject" %}<img title="Audio" class="item-type" src="{{ STATIC_URL }}img/audio.png">{% endif %}
        {% if doc.type == "Map" %}<img title="Map" class="item-type" src="{{ STATIC_URL }}img/map.png">{% endif %}
        {% if doc.type == "Periodical" %}<img title="Periodical" class="item-type" src="{{ STATIC_URL }}img/periodical.png">{% endif %}
        {% if doc.type == "WebPage" %}<img title="Web Page" class="item-type" src="{{ STATIC_URL }}img/webpage.png">{% endif %}

        {% if doc.thumbnailUrl %}
        <img itemprop="image" class="cover" src={{ doc.thumbnailUrl }}>
        {% endif %}

        {% if doc.alternateName %}
        <a href="{{ doc.id }}">
            <span itemprop="alterateName">{{ doc.alternateName }}</span>
        </a>
        {% if doc.author %}
        / 
        {% for author in doc.author %}
        {% if author.alternateName %}
        <span itemprop="author" itemtype="Person" itemscope>
            {% if forloop.last %}
            <span itemprop="name">{{ author.alternateName }}.</span>
            {% else %}
            <span itemprop="name">{{ author.alternateName }}</span> ; 
            {% endif %}
        </span>
        {% endif %}
        {% endfor %}
        {% endif %}
        {% endif %}

        <a href="{{ doc.id }}">
            <span itemprop="name">{{ doc.name }}</span>
        </a>

        {% if doc.author %}
        / 
        {% for author in doc.author %}
        <span itemprop="author" itemtype="Person" itemscope>
            {% if forloop.last %}
            <span itemprop="name">{{ author.name }}.</span>
            {% else %}
            <span itemprop="name">{{ author.name }}</span> ;
            {% endif %}
        </span>
        {% endfor %}
        {% endif %}

        {% if doc.bookEdition %}
        <span itemprop="bookEdition">{{ doc.bookEdition }}</span>.
        {% endif %}

        {% if doc.publisher %}
        <span itemprop="publisher" itemscope itemtype="Person">
            <span itemprop="address">{{ doc.publisher.address }}</span> :
            <span itemprop="name">{{ doc.publisher.name }}</span>
        </span>
        {% endif %}

        {{ doc.datePublished }}.

        <br>

        {% if doc.about %}
        Subjects:
        <ul class="subjects" itemprop="about">
            {% for subject in doc.about %}
            <li itemprop="about">{{ subject.name }}</li>
            {% if not forloop.last %} ; {% endif %}
            {% endfor %}
        </ul>
        <br>
        {% endif %}

        {% if doc.isbn %}
        ISBN: 
        {% for isbn in doc.isbn %}
        <span itemprop="isbn">{{ isbn }}</span>
        {% endfor %}
        <br>
        {% endif %}

        {% if doc.issn %}
        ISSN: 
        {% for issn in doc.issn %}
        <span itemprop="issn">{{ issn }}</span>
        {% endfor %}
        <br>
        {% endif %}

        <div itemprop="offers" class="offers">
          {% for offer in doc.offers %}
          <span class="offer" id="offer-{{ offer.serialNumber }}" itemtype="Offer" itemscope>
            <span itemprop="seller">{{ offer.seller }}</span>
          </span>
          {% if not forloop.last %} ; {% endif %}
          {% endfor %}
        </div>

    </article>
    {% endfor %}

    </section>

    <section id="facets" class="span3">

    <h2>{{ search_results.totalResults|intcomma }} items</h2>
    <hr>

    {% for facet in search_results.facets %}
        <h2>{{ facet.name }}</h2>
        <ul>
            {% for f in facet.counts %}
            {% if f.name != "Book / Ebook" %}
            <li>
              <a href="{% url "search" %}?{{ f.url }}">{{ f.name }}</a>
              ({{ f.count|intcomma }})
            </li> 
            {% endif %}
            {% endfor %}
        </ul>
        <hr>
    {% endfor %}
    </section>

    </div>

    <section class="search row pagination">
        <form class="span12" action="{% url "search" %}" method="get">
            <input style="float: left; margin-right: 10px;" name="q" type="text" placeholder="Search" value="{{ q }}"></input>
            <ul>
                {% if prev_page_range %}
                <li><a href="{% url "search" %}?{{ prev_page_range }}">&#x00ab;</a></li>
                {% endif %}

                {% for n, q in page_range %}
                <li {% if n == page %}class="active"{% endif %}><a href="{% url "search" %}?{{q}}">{{ n }}</a></li>
                {% endfor %}

                {% if next_page_range %}
                <li><a href="{% url "search" %}?{{ next_page_range }}">&#x00bb;</a>
                {% endif %}
            </ul> 
        </form>
    </section>

    {% if debug %}
    <h2>Debugging info:</h2>
    JSON: <a href="{{ json_url }}">{{ json_url }}</a>
    &nbsp;
    Summon: <a href="{{ raw_url }}">{{ raw_url }}</a>
    <br>
    <br>
    {% endif %}


</div>

{% endblock %}
