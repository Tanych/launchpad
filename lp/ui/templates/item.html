{% extends "base.html" %}
{% load launchpad_extras %}

{% block title %}{% if bib.CJK_INFO.TITLE %}{{ bib.CJK_INFO.TITLE }}{% else %}{{ bib.TITLE }}{% endif %}{% endblock title %}

{% block link_extra %}
<link rel='alternate' type='application/json' href='{% url item_json bibid %}' />
{% endblock link_extra %}

{% block content %}

<h1 class="title">
{% if bib.CJK_INFO.TITLE %}
    {{ bib.CJK_INFO.TITLE }} <br />
{% endif %}
{% if bib.TITLE|length <= 254 %}
    {{ bib.TITLE }}
{% else %}
    {{ bib.TITLE|truncatewords:-1 }}
{% endif %}
</h1>

{% if bib.AUTHOR or bib.CJK_INFO.AUTHOR or bib.AUTHORS %}
<span class="author">
{% if bib.CJK_INFO.AUTHOR %}
    {{ bib.CJK_INFO.AUTHOR }} <br />
{% endif %}
{% if bib.AUTHORS %}
    {{ bib.AUTHORS|join:"; " }}
    <br />
{% endif %}
</span>
{% endif %}

{% if bib.EDITION %}
<span class="edition">{{ bib.EDITION }}.</span>
{% endif %}
<span class="imprint">
{% if bib.CJK_INFO.IMPRINT %}
    {{ bib.CJK_INFO.IMPRINT }} <br />
{% endif %}
    {{ bib.IMPRINT }}</span>{% if bib.IMPRINT|slice:"-1:" == '.' or bib_IMPRINT|slice:"-2:" == '. ' %}{% else %}.{% endif %}

</span>
{% if bib.LANGUAGE_DISPLAY %}
In <span class="language">{{ bib.LANGUAGE_DISPLAY }}.</span>
{% endif %}
<br />

{% if bib.DISPLAY_ISBN_LIST %}
<span class="isbn-label">ISBN </span>
<span class="isbn">
	{% for isbn in bib.DISPLAY_ISBN_LIST %}
		{% if forloop.first %}{{ isbn }}
		{% else %}, {{ isbn }}
		{% endif %}
	{% endfor %}
</span><br/>
{% endif %}
{% if bib.DISPLAY_ISSN_LIST %}
<span class="isbn-label">ISSN </span>
<span class="issn">
	{% for issn in bib.DISPLAY_ISSN_LIST %}
		{% if forloop.first %}{{ issn }}
		{% else %}, {{ issn }}
		{% endif %}
	{% endfor %}
</span><br/>
{% endif %}

<p>

<span class="catlink">View detailed description of this title in the <a href='http://catalog.wrlc.org/cgi-bin/Pwebrecon.cgi?DB=local&BBID={{ bib.BIB_ID }}' target='newwin'>Aladin Catalog</a></span>
</p>


{% if holdings %}
    {% regroup holdings by LIBRARY_FULL_NAME as library_list %}
<table WIDTH='100%'> 
<!--
    <thead>
        <tr>
            <th width='40%'>Location</th>
            <th width='30%'>Call Number</th>
            <th width='15%'>Status</th>
            <th width='15%'>Consortium Loan</th>
        </tr>
    </thead>-->
    <tbody>		
    {% for library in library_list %}
        <tr><th colspan='4' class='library-group-header'>
            {{ library.grouper }}
        </th></tr>
        <tr>
            <th width='40%'>Location</th>
            <th width='30%'>Call Number</th>
            <th width='15%'>Status</th>
            <th width='15%'>Consortium Loan</th>
        </tr>
        {% for holding in library.list %}
        <tr>
            <td>{% if holding.AVAILABILITY.TEMPLOCATION %}
                <span class='temp-loc-label'>Temporarily held at:</span><br />
                    {{ holding.AVAILABILITY.TEMPLOCATION }}
                {% else %}
                    {{ holding.TRIMMED_LOCATION_DISPLAY_NAME }}
                {% endif %}
                {% if holding.LIBRARY_HAS %}
                    {% for line in holding.LIBRARY_HAS %}
                        <br />
                        <span class="library-has">{{ line }}</span>
                    {% endfor %}
                {% endif %}
            </td>
            <td>
                {% if holding.DISPLAY_CALL_NO %}
                {{ holding.DISPLAY_CALL_NO }}
                {% endif %}
            </td>
            <td>
                {% if holding.ELECTRONIC_DATA and holding.ELECTRONIC_DATA.LINK856U %}
                    {% if holding.ELECTRONIC_DATA.LINK8563 %}
                        <span class="link-volumes">[{{ holding.ELECTRONIC_DATA.LINK8563 }}]</span>
                    {% endif %}
                    {% if holding.LIBRARY_NAME != 'GW' and holding.LIBRARY_FULL_NAME != 'WRLC' %}
                <img style = 'height:1em;' src = '{{ STATIC_URL }}img/lock.png'> </img><a href="{{holding.ELECTRONIC_DATA.LINK856U}}" target="clswindow">Full text online {{holding.LIBRARY_NAME}} only</a>
                    {%else%}
                <a href="{{holding.ELECTRONIC_DATA.LINK856U}}" target="clswindow">Full text online </a>
                    {%endif%}
                {% else %}
                    {%if holding.AVAILABILITY.ITEM_STATUS_DESC = 'Not Charged'%}
                        <span style='color: green'>Available</span>
                    {%else%}
                        {% if holding.AVAILABILITY.TEMPLOCATION == 'WRLC Center'%}
                        <span class='off-site'>Off-site </span><br /><span class='off-site-explanation'>(Available by request)</span>
                        {% else %}
                            {{ holding.AVAILABILITY.ITEM_STATUS_DESC }}
                        {% endif %}
                    {%endif%}
                {% endif %}
            </td>
            <td>
                {% if holding.ELIGIBLE %}
                <a href='https://www.aladin.wrlc.org/Z-WEB/CLSReqForm?srcid=voyager:WRLC&bibid={{ holding.BIB_ID }}' target='clswindow'>Request</a><img src='{{ STATIC_URL }}img/external-link.jpg' width='16' height='10'/>
                {% endif %}
            </td>
        </tr>
        {% endfor %}
    {% endfor %}
    </tbody>
</table> 
{% else %}
<p>
No copies found in WRLC.  ADD ILL LINK.
</p>
{% endif %}

{% if debug %}
<h3>Debugging info</h3>

<p>
View JSON: <a href='{% url item_json bibid %}'>{% url item_json bibid %}</a>
&nbsp;

{% if bib.ISBN|clean_isbn %}
ISBN: <a href='{% url isbn bib.ISBN|clean_isbn %}'>{% url isbn bib.ISBN|clean_isbn %}</a>
&nbsp;
(<a href='http://findit.library.gwu.edu/go?isbn={{ bib.ISBN|clean_isbn }}'>findit</a>)
&nbsp;
{% endif %}
{% if bib.ISSN|clean_issn %}
ISSN: <a href='{% url issn bib.ISSN|clean_issn %}'>{% url issn bib.ISSN|clean_issn %}</a>
&nbsp;
(<a href='http://findit.library.gwu.edu/go?issn={{ bib.ISSN|clean_issn }}'>findit</a>)
&nbsp;
{% endif %}
{% if bib.NETWORK_NUMBER|clean_oclc %}
OCLC: <a href='{% url oclc bib.NETWORK_NUMBER|clean_oclc %}'>{% url oclc bib.NETWORK_NUMBER|clean_oclc %}</a>
&nbsp;
{% endif %}
</p>


{% endif %}

{% endblock content %}
