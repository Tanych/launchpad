{% extends "base.html" %}
{% load launchpad_extras humanize %}

{% block javascript_extra %}
<script>
  $(function() {
    $("#adv").submit(search);
  });

  function search(event) {
    var query = [];

    getKeyword("author", query);
    getPhrase("author", query);

    getKeyword("title", query);
    getPhrase("title", query);

    getKeyword("subject", query);
    getPhrase("subject", query);

    getKeyword("publisher", query);
    getPhrase("publisher", query);

    url = "/search?q=" + query.join(" AND ");
    url = addPublicationDate(url);

    location.href = url;
    return false;
  }

  function getKeyword(name, query) {
    var p = $("#" + name + "-keywords").val();
    if (p) {
      query.push(name + ":" + "(" + p + ")")
    }
  }
  
  function getPhrase(name, query) {
    var p = $("#" + name + "-phrase").val();
    if (p) {
      query.push(name + ":" + '"' + p + '"')
    }
  }

  function addPublicationDate(url) {
    var year = $("#publication-year").val();
    var start = $("#publication-year-start").val();
    var end = $("#publication-year-end").val();

    if (start && end) {
      url += '&pubyear=' + start + ':' + end;
    } else if (start) {
      url += '&pubyear=' + start + ':'
    } else if (end) {
      url += '&pubyear=:' + end; 
    } else if (year) {
      url += '&pubyear=' + year
    }

    return url;
  }

</script>
{% endblock %}

{% block content %}

<div class="libsite-container container">

  <form id="adv" class="form-horizontal" onsubmit="search">

    <fieldset>

      <legend>Author</legend>

      <div class="control-group">
        <label class="control-label" for="author-keywords">Keywords</label>
        <div class="controls">
          <input class="input-xxlarge" type="text" id="author-keywords">
        </div>
      </div>

      <div class="control-group">
        <label class="control-label" for="author-phrase">Exact Phrase</label>
        <div class="controls">
          <input class="input-xxlarge" type="text" id="author-phrase">
        </div>
      </div>

    </fieldset>

      <legend>Title</legend>

      <div class="control-group">
        <label class="control-label" for="title-keywords">Keywords</label>
        <div class="controls">
          <input class="input-xxlarge" type="text" id="title-keywords">
        </div>
      </div>

      <div class="control-group">
        <label class="control-label" for="title-phrase">Exact Phrase</label>
        <div class="controls">
          <input class="input-xxlarge" type="text" id="title-phrase">
        </div>
      </div>

    </fieldset>

    <fieldset>

      <legend>Subject</legend>

      <div class="control-group">
        <label class="control-label" for="subject-keywords">Keywords</label>
        <div class="controls">
          <input class="input-xxlarge" type="text" id="subject-keywords">
        </div>
      </div>

      <div class="control-group">
        <label class="control-label" for="subject-phrase">Exact Phrase</label>
        <div class="controls">
          <input class="input-xxlarge" type="text" id="subject-phrase">
        </div>
      </div>

    </fieldset>

    <fieldset>

      <legend>Publisher</legend>

      <div class="control-group">
        <label class="control-label" for="publisher-keywords">Keywords</label>
        <div class="controls">
          <input class="input-xxlarge" type="text" id="publisher-keywords">
        </div>
      </div>

      <div class="control-group">
        <label class="control-label" for="publisher-phrase">Exact Phrase</label>
        <div class="controls">
          <input class="input-xxlarge" type="text" id="publisher-phrase">
        </div>
      </div>

    </fieldset>

    <fieldset>

      <legend>Publication Date</legend>

      <div class="control-group">
        <label class="control-label" for="publication-year">Year</label>
        <div class="controls">
          <input class="span1" min="1000" type="number" id="publication-year">
        </div>
      </div>

      <div class="control-group">
        <label class="control-label" for="publication-year-start">Year Range</label>
        <div class="controls">
          <input class="span1" min="1000" type="number" id="publication-year-start">
          &nbsp; to &nbsp;
          <input class="span1" min="1000" type="number" id="publication-year-end">
        </div>
      </div>

    </fieldset>

    <br>
    <br>
    <button>Advanced Search</button>

  </form>

</div>

{% endblock %}
